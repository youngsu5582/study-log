---
tags:
  - 리팩토링
도서명: 객체지향의 사실과 오해
저자명: 조영호
---
#### 재판 속의 협력

하트 잭 재판하기 위해 등장인물들은 어떤 방식으로 협력하고 있는가

하트 잭의 재판 과정 역시도 재판 참여하고 많은 사람들이 요청 & 응답하는 과정 속에서 이루어짐

1. 누군가가 왕에게 재판을 <span style="color:#00b0f0">요청</span> 함으로써 재판이 시작된다
2. 왕이 하얀 토끼에게 증인을 부를 것을 <span style="color:#00b0f0">요청</span> 한다.
3. 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 <span style="color:#00b0f0">요청</span> 한다.
모자 장수는 증인석에 입장함으로써 토끼의 요청에 <span style="color:#fb3c3c">응답</span> 한다.
모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 <span style="color:#fb3c3c">응답</span> 이기도 하다.
4. 이제 왕은 모자 장수에게 증언할 것을 <span style="color:#00b0f0">요청</span> 한다.
모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 <span style="color:#fb3c3c">응답</span> 한다.

누군가 왕에게 재판 해달라는 <span style="color:#00b0f0">요청</span> 을 보냈다는 말은
왕이 재판을 수행할 <span style="color:#00b050">의무</span> + 재판에 필요한 지식을 가지고 있다는 의미

왕이 토끼에게 목격자를 불러오라는 <span style="color:#00b0f0">요청</span> 한 이유는
토끼가 목격자에 대해 알고 있으며 + 목격자를 부를 의무가 있다는 의미

결국 어떤 등장인물들이 특정 요청을 받아들일 수 있는 이유는
요청에 대해 적잘한 방식으로 응답하는 데 필요한 지식 과 행동 방식을 가지고 있기 떄문

#### 책임

어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나
적절한 행동을 할 의무가 있는 경우 해당 객체가 책임을 가진다는 것

왕은 "재판을 수행하라" 는 요청에 응답해야 하므로
재판을 수행할 책임을 지게 된다

> 객체지향 개발에서 가장 중요한 능력은 책임을 능숙하게 SW 객체에게 할당하는 것 - 크레이그 라만

책임을 어떻게 구현할 것인가는 객체와 책임이 제자리 잡은 후 고려해도 늦지 않음!!
( 성급히 구현에 뛰어드는 것은 변경에 취약하고 , 다양한 협력에 참여할 수 없는 비자율적 객체 낳게 된다 )
##### 책임의 분류

협력에 참여하는 객체들은 목표를 달성하는 데 필요한 책임을 수행
책임은 결국 객체에 의해 정의됨 + 응집도 있는 행위의 집합

-> 객체의 책임은 '객체가 무엇을 알고 있는가(knowing) 와 무엇을 할 수 있는가(doing) 로 구성된다'

- 하는 것 ( doing )
	- 객체를 생성하거나 계산을 하는 등 스스로 하는 것
	- 다른 객체 행동을 시작시키는 것
	- 다른 객체 활동 제어 & 조절하는 것
- 아는 것 ( knowing )
	-  개인적인 정보에 관해 아는 것
	- 관련된 객체에 관해 아는 것
	- 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

왕이 하얀 토끼에게 목격자를 불러오도록 요청 후 , 모자 장수에게 증언하도록 요청하는 것은?
-> 다른 객체들의 활동을 제어하고 조율하므로 관련된 책임을 수행

하얀 토끼는 목격자가 모자 장수라는 사실을 알며 , 모자 장수가 증인석에 입장하도록 요청하는 것은?
-> 개인 정보를 알며 다른 객체 행동을 시작시키는 것이므로 두 가지 종류 모두 수행

모자 장수는 스스로 증인석 입장 하는 책임 과 , 자신이 알고 있는 사실을 증언해야 하는 책임을 가지고 있다
-> 첫 번째 책임은 "객체를 생성하거나 계산을 스스로 하는 등" 두 번째 책임은 "자신이 유도하거나 계산할 수 있는 것"

책임은 객체지향 설계 품질을 결정하는 가장 중요한 요소
> 적절한 객체에게 적절한 책임을 할당하는 데 있다

책임은 객체 외부에 제공해 줄 수 있는 정보 ( 아는 것의 측면 ) 와 외부에서 제공해 줄 수 있는 서비스 ( 하는 것의 측면 )
=> 객체의 <span style="color:#00b050">공통 인터페이스</span> ( 이는 캡슐화로 이어짐 )
##### 책임과 메시지

객체는 다른 객체로부터 요청이 전송된 경우에만 자신에게 주어진 책임 수행

- 객체가 다른 객체에게 전송한 요청은 그 요청을 수신한 객체의 책임이 수행되게 한다
=> 주어진 책임을 수행하도록 요청을 보내는 것을 `메시지 전송` 이라 한다

메시지를 전송함으로써 협력을 요청하는 객체를 <span style="color:#00b0f0">송신자</span> 
메시지를 수신함으로써 요청을 처리하는 객체를 <span style="color:#00b0f0">수신자</span> 

책임이 협력이라는 문맥 속 요청 수신 한 쪽 객체 관점에서 무엇을 할 수 있는지 나열하는 것이라면 <-> 
메시지는 협력에 참여하는 두 객체 사이 관계를 강조하는 것

책임은 - 다른 객체 여부 상관없이 모자 장수가 외부에 제공할 수 있는 행위의 일부
메시지 관점에서는 - 항상 메시지를 전송하는 객체와 메시지 수신하는 객체가 상호 협력하는 문맥을 강조!

⭐️ 하지만 , 책임 과 메시지의 수준이 같지 않다는 것을 주의하자!

하나의 책임이 여러 개의 메시지로 분할되는 것이 일반적

책임을 구현하는 방법에 대한 고민은 미루는 것이 좋다

-> 메시지를 송 & 수신 할 수 있다는 것을 결정하는 것이 더 중요하다
=> 협력에 참여하기 위해 어떤 객체가 어떤 책임을 수행해야 하고 , 어떤 객체로부터 메시지를 수신할 지 결정하는 것부터 시작된다!
#### 역활
##### 책임의 집합이 의미하는 것

재판이라는 협력에 참여하기 위해
모자 장수는 `증인` 이라는 역활을 수행 , 왕은 `판사` 라는 역활을 수행

객체가 수행하는 책임의 집합은 객체가 협력 안해서 수행하는 역활들을 암시
( 왜 왕을 판사라고 부르고 , 모자 장수를 증인이라고 불러서 상황을 복잡하게 만들어야 하는가? )

역활이 재사용 가능하고 , 유연한 객체지향 설계를 낳는 매우 중요한 구성요소 이기 때문

모자 장수 다음으로 , 요리사 , 앨리스가 증인으로 재판 과정에 참석하게 되었다!

요리사가 증언하는 과정
1. 왕의 요청을 받은 토끼가 요리사가 증인석으로 입장할 것을 요청
2. 요리사는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 응답

앨리스가 증언하는 과정
1. 여왕의 요청을 받은 토끼가 앨리스를 증인석으로 입장할 것을 요청
2. 앨리스는 자신이 알고 있는 내용을 증언함으로써 여왕의 요청에 응답

세 가지 과정이 완벽하게 동일하다
왕 -> 여왕이 , 모자 장수 -> 요리사 , 앨리스 로 교체된 것 뿐!
( 세 개의 협력을 별도로 관리하고 유지해야 하는가? )
##### 그렇기에 역활이 답이다
세 개의 협력이 등장인문들을 제외하고는 너무나도 유사하다!
-> 하나의 협력으로 다루고 싶다
=> 역활을 사용해 세 가지 협력을 모두 포함할 수 있는 하나의 협력으로 추상화를 해나가자

누군가는 "판사" 에게 재판을 요청함으로써 재판이 시작된다.
"판사"는 하얀 토끼에게 증인을 부를 것을 요청한다.
"판사"의 요청을 받은 토끼는 "증인"이게 증인석으로 입장할 것을 요청한다.
"증인"은 증인석에 입장함으로써 토끼의 요청에 응답한다.
"증인"의 입장은 연쇄적으로 토끼에 대한 판사의 요청에 대한 응답이기도 하다.
이제 "판사"는 "증인"에게 증언할 것을 요청한다.
"증인"은 자신이 알고 있는 내용을 증언함으로써 "판사"의 요청에 응답한다.

⭐️ 역활은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식
( 해당 역활을 수행하는 어떤 객체라도 대신할 수 있습니다 라고 말해주는 것 )
- 역활을 대체할 수 있는 객체는 동일한 메시지를 이해할 수 있는 객체
=> 역활은 객체지향 설계의 단순성 , 유연성 , 재사용성을 뒷받침하는 핵심 개념이다
##### 협력의 추상화

역활의 가장 큰 가치는 협력 안에 여러 종류 객체가 참여할 수 있게 함으로써 협력을 <span style="color:#fb3c3c">추상화</span> 할 수 있다는 것
동일한 구조의 협력을 다양한 문맥에서 재사용 가능하다는 능력이 객체지향만의 힘!
##### 대체 가능성
역활은 협력 안에서 구체적 객체로 대체될 수 있는 추상적 협력자다
-> 다른 객체 의해 대체 가능함을 의미

객체가 역활을 대체하기 위해선 행동이 호환되어야 함을 주목해야 한다
( 대체할 수 있는 이유는 대체 되기전의 객체의 역활을 수행할 수 있기 때문이다! )

다만 , 객체가 역활이 주어진 책임 이외 다른 책임 수행할 수 있다는 사실도 주목하자
-> 왕은 재판을 할 책임 뿐 아니라 , 국정 돌봐야 할 추가적인 책임 역시 가지고 있다

객체는 역활이 암시하는 책임보다 더 많은 책임을 가질 수 있따

-> 대부분 경우 객체 타입 - 역활 사이에는 일반화 / 특수화 관계가 성립하는 것이 일반적

역활의 대체 가능성 = 행위 호환성 ( 행위 호환성은 동일한 책임의 수행을 의미 )

---
#### 객체의 모양을 결정하는 협력
##### 흔한 오류

많은 사람들은 시스템에 필요한 데이터를 저장하기 위해 객체가 존재한다는 선입견을 가진다

객체가 상태의 일부로 데이터를 포함하는 것은 사실이나
데이터는 단지 객체 행위 수행하는 데 필요한 재료일 뿐!

( 객체가 존재하는 이유는 행위를 수행하며 협력에 참여하기 위해서 => 객체의 행동이 중요 , 즉 책임이 중요 )

객체지향이 클래스 와 클래스 간 관계를 표현하는 시스템의 정적인 측면에 중점을 둔다고 선입견을 가진다

중요한 것은 정적인 클래스가 아니라 , 협력 참여하는 동적인 객체이며
클래스는 단지 시스템에 필요한 객체를 표현하고 생성하기 위한 언어가 제공하는 구현 매커니즘

( 협력 안에서 어떤 책임과 역활을 수행할 것인지 결정 하는 것 )

입문자들이 데이터나 클래스를 중심으로 설계하는 이유는
협력이라는 문맥을 고려하지 않고 객체를 독립적으로 바라보기 때문

EX) '왕' 이라는 인스턴스를 모델링한다면?
자신이 생각하는 왕의 모습을 떠올림 -> 떠올린 왕의 모습을 기반으로 클래스 개발

전형적인 모습을 빌려 객체를 창조하는게 합리적이고 적절해 보일지 모르지만
실제 동작 애플리케이션 구축하기 위해선 왕이 참여하는 협력을 우선적 고려해야한다!

앨리스의 이야기에서 왕은 단순히 '판사'의 역활로 참여해서 죄인의 죄를 판결하는 책임을 수행할 수 있기 때문
##### 협력에 따라 흐르는 객체의 책임

올바른 객체를 설계하기 위해서 먼저 견고하고 깔끔한 협력을 설계해야 한다
-> 설계에 참여하는 객체들이 주고받는 요청 과 응답의 흐름을 결정한다는 것을 의미
=> 결정된 요청 과 응답의 흐름이 객체가 협력에 참여하기 위해 수행될 책임!

객체에 책임을 할당하고 나면 책임은 객체가 외부에 제공하게 될 행동
( 행동을 결정한 후에는 협력이라는 문맥속에서 행동 수행하는데 필요한 데이터만 고민하면 끝 )

=> 객체지향에서 가장 중요한 것은 충분히 자율적인 동시에 충분히 협력적인 객체를 창조하는 것!

객체를 충분히 협력적으로 만든 후 문맥 안에서 충분히 자율적으로 만드는 것
#### 객체지향 설계 기법

역활 , 책임 , 협력이 견고하고 유연한 객체지향 설계를 위한 중요한 토양!

이 관점에서 설계하는 유용한 세 가지 기법 존재
#### 책임 주도 설계

협력에 필요한 책임들 식별 , 적합한 객체에 책임을 할당하는 방식으로 애플리케이션 설계

결국 객체지향 설계는 기능 구현 위한 협력 관계를 고안하고
협력에 필요한 역활 과 책임을 식별한 후 이를 수행할 수 있는 적절 객체를 식별해나가는 과정!

설계의 핵심은 올바른 책임을 올바른 객체에가 할당하는 것
( 객체지향 언어를 사용하거나 UML 같은 모델링 언어 이용한다고 효율적 & 견고한 시스템 보장되는 것이 아님 )
-> 전체 개발 단계를 걸쳐 객체의 역활과 책임 , 협력을 도드라지게 만드는 기법 과 체계를 따르는 것이 중요하다
	
책임 주도-설계는 객체의 책임을 중심으로 시스템을 구축하는 설계 방법

시스템의 기능은 더 작은 규모의 책임으로 분할
-> 각 책임은 책임을 수행할 적절한 객체에게 할당
-> 책임 수행 도중 스스로 처리할 수 없는 정보나 기능이 필요한 경우 적절 객체를 찾아 필요한 작업 요청
-> 작업 수행하는 일은 작업을 위임받은 객체의 책임으로 변환
=> 다른 객체에게 작업 요청하는 행위를 통해 객체들 간 협력 관계가 만들어짐
( 책임을 여러 종류가 수행할 수 있다면? -> 협력자는 추상적 역활로 대체 )
#### 디자인 패턴

책임-주도 설계는 객체의 역활 , 책임 , 협력을 고안하기 위한 방법과 절차를 제시한다
디자인 패턴은 책임 - 주도 설계의 결과를 표현한다 
-> 모범이 되는 설계

패턴은 결국 특정 상황에서 설계를 돕기 위해 모방하고 수정할 수 있는 과거의 설계 경험

디자인 패턴은 반복적 발생 문제와 - 문제에 대한 해법의 쌍으로 <span style="color:#fb3c3c">정의</span>
패턴이 반복해서 일어나는 특정 상황에서 어떤 설계(why) 가 더 효과적인지 대한 이유를 설명한다

=> 디자인 패턴을 잘 알고 있다면 책임-주도 설계 절차를 따르지 않고도
시스템 안 구현 객체 역활 & 책임을 빠르게 포착 가능
#### 테스트-주도 개발

애자일 방법론의 한 종류인 XP 의 프랙티스로 주목받기 시작한 설계 기법

테스트-주도 개발은 객체가 이미 존재한다고 가정하고 
객체에게 어떤 메시지 전송할 것인지 먼저 생각해보라고 충고
( 충고는 역활 , 책임 , 협력 관점에서 객체 바라보지 않을 경우 무의미 )

TDD 는 결국 다양한 설계 경험 과 패턴에 대한 지식 없는 사람들의 경우 
온전한 혜택을 누리기가 어렵다는 것

객체지향에 대한 깊이 있는 지식 요구

테스트를 작성하기 위해 객체의 메소드를 호출하고 , 반환값 검증하는 것은
-> 객체가 수행해야 하는 책임에 관해 생각 해나가는 것

테스트에 필요한 간접 입력 값 제공하기 위해 스텁을 추가하거나
간접 출력 값을 검증하기 위해 목 객체 사용하거나
이 모든게 객체와 협력해야 하는 협력자에 관해 고민한 결과를 코드로 표현한 것!
