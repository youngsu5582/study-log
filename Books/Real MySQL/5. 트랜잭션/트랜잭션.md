
작업의 완전성을 보장
-> 논리적인 작업 셋 모두 완벽하게 처리
-> 처리하지 못할 경우 원 상태 복구해 작업 일부만 적용되는 현상 방지

## 트랜잭션

논리적인 작업 셋 자체 100% 적용 ( COMMIT )
아무것도 적용되지 않아야 ( ROLLBACK ) 함을 보장한다.

> MyISAM 은 부분 업데이트 ( Partial Update ) 때문에 정합성 맞출때 상당히 어려운 문제를 만들어낸다.
> 
> 3이라는 데이터가 이미 존재할 떄, 1,2,3 을 삽입하면 3에서 예외가 발생하지만 1,2를 삭제하진 않는다.

트랜잭션 역시도, DBMS 커넥션과 동일하게 최소 코드에만 적용하는게 좋다.
-> 프로그램 코드에서도 트랜잭션 범위 최소화

```
1. 처리 시작
=> DB 커넥션 생성
=> 트랜잭션 시작

2. 사용자의 로그인 여부 확인
3. 사용자의 글쓰기 내용 오류 여부 확인
4. 첨부로 업로드된 파일 확인 & 저장

5. 사용자의 입력 내용을 DBMS에 저장
6. 첨부 파일 정보를 DBMS에 저장

7. 저장된 내용 또는 기타 정보 DBMS 에 조회
8. 게시물 들옥에 대한 알림 메일 발송
9. 알림 메일 발송 이력 DBMS에 저장
<= 트랜잭션 종료 ( COMMIT )
<= DB 커넥션 반납

10. 처리 완료
```

- 실제, 개발자들이 DB 커넥션 생성 부분을 메소드 진입점에 한다.
2,3,4 번은 아무리 빨리 된다고 하더라도 트랜잭션에 포함시킬 필요 없다.
-> 커넥션 소유 시간이 길어질수록 사용 가능한 여유 커넥션 개수는 줄어든다.

- 8번 작업은 외부 API 이다. 프로그램 실행 동안 메일 서버와 통신할 수 없는 문제가 발생하면 웹 서버 + DBMS 서버까지 위험해질 수 있다.
-> 어떻게든, DBMS 트랜잭션 내에서 제거하는 것이 좋다.

5번과 6번 작업은 반드시 묶여야 하나 (사용자 입력 정보 저장 일관성)
7번은 단순 조회라고 판단 가능
9번 작업은 성격이 다르므로 이전 트랜잭션과 묶지 않아도 무방해보인다.




