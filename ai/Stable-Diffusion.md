> https://wikidocs.net/233889
> 해당 내용을 참고했습니다.

> 사내 사용하고 있는 부분들만 다룹니다.

텍스트, 이미지 프롬프트에서 고유 실사 이미지를 생성하는 인공 지능 모델

- 확산 기술을 기반 + 잠재 공간 ( latent space ) 사용
  -> 처리 요구 사항이 크게 줄어들며, GPU 장착된 데스크톱 및 노트북에서 모델 실행 가능

- 전이 학습을 통해 최소 5개의 이미지로도 특정 요구 사항을 충족하게 미세 조정
  -> 작업헤서 학습된 지식을 다른 유사 작업에 활용해 모델 성능을 개선

---

### Batch

동시 처리되는 이미지 그룹, 한 번에 여러 이미지 생성하고 처리하는 기술적 방법

- Batch Size : 한 번에 모델 실행해 동시 처리될 수 있는 이미지 수
- Batch Count : 생성할 배치의 총 수, Batch Size 5 `*` Batch Count 4 = 20 Image

### CFG Scale

![](https://i.imgur.com/Z5vbW7P.png)

낮으면 텍스트 프롬프트를 덜 엄격히 따름, 추상적이고 자유로운 스타일
높으면 텍스트 프롬프트를 엄격히 따름, 주어진 설명과 밀접히 일치 + 세부 사항 더 정확히 반영

### CheckPoint

학습 과정에서 특정 시점에 저장한 상태
모델의 가중치, 하이퍼 파라미터, optimizer 상태 등을 포함

- 복원성 : 학습 과정 중 발생한 문제 ( 시스템 충돌, 전력 문제 ) 후에도 모델 이전 상태로 복원 - 시간 및 리소스 절약
- 학습 과정 모니터링 : 여러 체크포인트 비교해 모델 학습 진행 상황 모니터링, 모델 발전을 평가
- 모델 실험과 평가 : 다양한 학습 시점을 저장, 여러 체크포인트를 사용해 실험 수행 및 최적 모델 찾기 가능
- 재사용, 공유 : 공유함으로, 모델 재사용 및 성능 검증을 통해 추가적 학습 없이 새로운 데이터에 모델 적용

이미지 생성 태스크에 최적화된 상태로 저장
-> 사용자는 사전 학습된 모델을 바로 사용해 이미지 생성, 자신의 데이터 셋으로 추가 학습 진행 가능

`.ckpt` 형태로 저장되고, 모델의 구조와 가중치 모두 포함

### Denoising Strength

노이즈를 제거하는 정도를 결정하는 매개변수

- 0과 1 사이 설정

#### 값이 낮을 때 ( 0.2 이하 )

- 초기 추가된 노이즈 중 작은 부분만 제거
  -> 노이즈 대부분이 이미지에 남아 있어서 이미지는 더 추상적이고 환상적인 모습
- 원본 형태나 패턴이 덜 명확하게 표현
- 원본 노이즈 이미지 특성이 더 많이 보존, 창의적 및 예측할 수 없는 결과

#### 값이 중간일 때 ( 0.5 주변 )

- 사용자의 입력과 관련이 있으면서 일정 수준 추상성 유지

#### 값이 높을 때 ( 0.8 이상 )

- 이미지에서 대부분 노이즈 제거
- 이미지가 훨씬 더 세밀하고, 정확한 디테일, 원래 형태 및 주제가 분명히 드러남
- 너무 높을 시, 이미지가 과도하게 처리되거나 자연스럽지 않은 세부 사항 포함 가능

### Diffusion Model

이미지 생성 과정을 확률적으로 모델링하는 방법

![500](https://i.imgur.com/BgiNMsz.png)

#### Forward Process - 전파 과정

원본 이미지에서 시작해 점차적 노이즈 추가
여러 단계를 거치며, 단계마다 원본에서 멀어져 가며, 마지막엔 거의 순수한 노이즈 상태로 이름

노이즈로 가득 찬 이미지에서 시작해 점차 원하는 이미지로 변환시키는 과정 수행

#### Reverse Process 0 역전 과정

전파 과정의 반대, 순수 노이즈 상태에서 시작해 원본 이미지로 되돌아가는 과정
특정 조건 ( 텍스트 설명 ) 에 기반해 노이즈 점차적 제거

### LoRA - 모델 미세조정 기술

Low-Rank Adaptation

기존 딥 러닝 모델 파라미터를 수정하지 않고, 추가적인 작은 파라미터 집합 통해서 모델 미세조정 기술
-> 대규모 언어 모델이나 이미지 생성 모델 같은 고용량 모델을 빠르게 효율적 및 미세조정

- 저랭크 구조 ( Low-Rank Structure )

LoRA 는 추가적 파라미터 사용해 원본 모델 가중치 조정
작은 차원의 행렬을 사용해 원본 가중치 변화 모델링

- 효율적인 학습 및 적용

미세조정 과정에서 필요한 메모리와 계산 리소스 줄여줌, 새로운 태스크나 데이터셋에 모델 빠르게 적응

- 범용성과 확장성

다양한 유형과 모델과 태스크에 적용 가능, `언어 모델링`, `이미지 생성`, `음성 인식` 등 다양한 영역에서 이 방법 사용해 모델 성능 개선

특정 아티스트의 그림 스타일 모방해 모델 미세조정 및 특정 유형 이미지 생성에 모델 최적화

### Sampling Method

샘플러는 잡음 제거 단계를 수행하는 역할 담당

수많은 샘플링 존재

```
## 샘플링 방법 선택 전략

다양한 샘플러들 사이에서 선택하는 것은 당신의 특정 목표, 이미지 생성에 대한 요구사항, 그리고 처리 시간에 대한 선호도에 따라 달라질 수 있습니다. 여기 각 상황에 맞는 샘플러 선택 전략을 몇 가지 소개합니다:

### 1. 품질 중시:

- **LMS (Langevin Monte Carlo Sampling)**: 고품질의 이미지가 필요한 경우, LMS는 복잡한 세부 사항과 질감을 잘 재현할 수 있기 때문에 좋은 선택입니다.
- **DPM++ Karras**: Karras 방법을 적용한 DPM++ 샘플러는 세부 사항과 질감에 중점을 둔 고화질 이미지 생성에 적합합니다.

### 2. 속도 중시:

- **Euler**: 빠른 결과가 필요할 때 Euler 방법은 간단하고 빠르게 이미지를 생성할 수 있어 유용합니다.
- **DPM fast**: 속도를 우선시하는 경우에 적합하며, 빠른 이미지 생성이 가능합니다.

### 3. 안정성과 다양성의 균형:

- **Heun**: 균형 잡힌 품질과 속도를 제공합니다. Heun 샘플러는 예측자-교정자 접근 방식을 사용하여 안정적인 결과물을 생성합니다.
- **DPM2**: 다양한 이미지를 생성하면서도 안정적인 결과를 원할 때 적합합니다.

### 4. 실험적인 이미지 생성:

- **SDE (Stochastic Differential Equations)**: 복잡하고 창의적인 이미지 생성을 탐구하고 싶을 때 SDE 샘플러를 사용할 수 있습니다. 이 방법은 이미지의 세부 사항과 질감을 다양하게 재현할 수 있습니다.
- **DPM++ 2M SDE Exponential**: 다양한 효과와 세부 정보를 제공하는 고급 샘플러입니다.

### 5. 조건부 이미지 생성:

- **Ancestral**: 특정 조건이나 시퀀스에 따라 이미지를 생성할 때 유용합니다. Ancestral 샘플링은 복잡한 확률 분포에서 샘플을 순차적으로 생성합니다.
- **DPM++ 2S a**: 안정화와 세부 조정이 강화된 조건부 이미지 생성에 적합합니다.

### 6. 세부 조정과 커스터마이징:

- **DPM++ 2M Karras**: 세부 사항과 질감을 개선하려면, Karras 변형을 적용한 이 방법을 사용해보세요.
- **PLMS (Predictor-corrector Langevin Monte Carlo Sampling)**: 부드러운 이미지 전환과 높은 품질의 결과물을 원할 때 좋은 선택입니다.

선택할 샘플러를 결정할 때, 각각의 장단점을 고려하고, 가능하다면 몇 가지 다른 샘플러를 실험해 보면서, 생성된 이미지의 품질과 스타일이 프로젝트의 목표와 일치하는지 확인하는 것이 좋습니다. 또한, 처리 시간과 컴퓨팅 리소스의 제한도 고려해야 합니다.
```

왜 조합해서 사용해야 하는가?

- 품질 향상 : 다양한 샘플링 메소드를 조합하면 각 방법 결합해 보다 높은 품질 이미지 생성
  -> 최종적으로 더 리얼리스틱 & 세부적 이미지

- 다양성 및 창의성 증진 : 각기 다른 종류 변화와 창의성을 이미지에 더함, 다양하고 창의적인 결과물 생성
  -> 특정 상황이나 요구 사항에 맞는 이미지 스타일 실험하고 탐색에 도움이 된다.

- 특정 문제 최적화 : 특정 문제 및 요구 사항에 잘 맞을 수 있음, 방법을 조합해 특정 목표에 최적화

- 성능과 속도 균형 : 뛰어난 품질 제공하지만 계산 비용이 높을 수 있음, 적절히 조합해 원하는 품질 수준은 유지하며 계산 비용을 줄임

- 고유한 특성의 조합 : `"DPM++ 2M SDE Heun Exponential"` 은?

DPM++ ( 기본 샘플러 ) + 2M ( 두 개의 측정값 ) + SDE ( 확률적 미분 방정식 ) + Heun ( 보다 정확한 샘플링 ) + Exponential ( 지수적
변형 )

=> 사용자가 원하는 이미지의 특성을 더 세밀하게 제어

### Sampling Steps

이미지 생성 과정에서 모델이 노이즈를 점진적 제거하며 이미지를 세밀화하는 단계의 수

- 낮을 경우 : 노이즈 제거를 적게 하므로, 생성 과정은 빠르나 디테일이 덜 하거나 더 추상적
- 높은 경우 : 더 많은 단계를 거치므로, 더 세밀하고 정교할 가능성 존재

### Seed

무작위성을 제어하는 값

- 재현성 : 동일 시드값 사용하면, 모델이 완전 동일한 이미지 다시 생성 가능 - 특정 이미지 정확히 재현시 유용
- 다양성 : 다른 시드 사용하면, 같은 텍스트 프롬프트 & 설정 불구하면 다른 이미지 생성 가능

이미지를 생성할 때 마다 새로운 시드 값 설정하거나, 무작위 시드값 선택하도록 가능
특정 이미지 다시 생성하고 싶다면, 이미지 생성할 때 사용한 동일 시드값 사용

#### 다양한 요소에 의한 결과 변화

시드 이외에도 다른 요소들이 바뀌면 다른 결과가 나올 수 있다.

- 이미지 크기 : 이미지 너비와 높이가 바뀌면, 모델이 처리하는 픽셀의 양이 변함 -> 세부 사항 및 질감에 영향
- 모델 매개변수 : 모델의 다른 설정이나 매개변수 변경 시, 생성 과정에 영향을 미침 - 해상도, 레이어 수 조정 등등

=> 시드값이 모든 변수를 제어할 수 없다. 그럼에도, 여전히 중요하다.

특정 이미지 다시 생성하거나 변형할 때 시작점을 일정히 유지 가능해 다른 변수의 영향을 분석하고 이해하는 데 도움을 준다.